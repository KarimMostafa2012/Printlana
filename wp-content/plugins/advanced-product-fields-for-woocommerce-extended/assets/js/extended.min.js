!function(){const s=".wapf-";function r(e){for(var t=0,n=["<=",">=","!=","=",">","<"],a=0;a<e.length;a++)if("("===e[a]&&t++,")"===e[a]&&t--,!(0<t))for(var r of n)if(e.substring(a,a+r.length)===r)return{operand:r,left:e.substring(0,a).trim(),right:e.substring(a+r.length).trim()};return{operand:"=",left:e.trim(),right:"true"}}function i(e,t){return"true"===(e=a(e,t,!1))||"false"!==e&&(""===e?"":(t=p.evalFx(""+e,!1),isNaN(t)?e:t))}function f(e,t,n,a){switch(e=i(e,a),t=i(t,a),n){case"<":return e<t;case">":return t<e;case">=":return t<=e;case"<=":return e<=t;case"!=":return e!==t;default:return e===t}}var p=WAPF.Util,a=p.parseFx,e=WAPF.Util.formulas;["abs","floor","ceil","sqrt","sin","cos","tan"].forEach(function(n){e[n]=function(e,t){return Math[n](a(e[0],t))}}),e.formatNumber=function(e,t){var n=wapf_config.display_options,t=a(e[0],t);return p.formatNumber(t,1<e.length?e[1]:n.decimals,n.thousand,n.decimal,n.trim_zeroes)},e.round=function(e,t){var n=a(e[0],t);if(e[1]){t=a(e[1],t);return Math.round(n*Math.pow(10,t))/Math.pow(10,t)}return Math.round(n)},e.pow=function(e,t){return Math.pow(a(e[0],t),a(e[1],t))},e.checked=function(e,t){e=t.find(".input-"+e[0]),e=p.getFieldValue(e,!0);return Array.isArray(e)?e.length:0},e.files=function(e,t){e=t.find(".input-"+e[0]);if(1!==e.length)return 0;e=p.getFieldValue(e,!0);return e?e.split(",").length:0},e.sumQty=function(e,t){var t=t.find(".field-"+a(e[0],t,!1)+" .wapf-input"),n=0;return t.each(function(){n+=Number(jQuery(this).val())}),n},e.if=function(e,t){var n=r(e[0]);return f(n.left,n.right,n.operand,t)?e[1]:e[2]},e.or=function(e,t){for(var n=0;n<e.length;n++){var a=r(e[n]);if(f(a.left,a.right,a.operand,t))return"true"}return"false"},e.and=function(e,t){for(var n=0;n<e.length;n++){var a=r(e[n]);if(!f(a.left,a.right,a.operand,t))return"false"}return"true"};var u=wapf_config.date_format;function d(e,t,n){t=e[n||0]?a(e[n||0],t,!1):"";return!!t&&dpParseDate(t,u)}e.datediff=function(e,t){var n=d(e,t),t=d(e,t,1);return n&&t?Math.round((t.getTime()-n.getTime())/864e5):0},e.today=function(){return dpFormatDate(new Date(wapf_config.today),u)},e.dow=function(e,t){t=d(e,t);return t?t.getDay():0};function l(e,t,n){var a="string"==typeof e?e.split(/-/g):e,r=parseInt(a[0])-1,i=parseInt(a[1]),e=t||(2===a.length?(new Date).getFullYear():parseInt(a[2]));return n||1!=r||29!==i||t%4==0&&(t%100!=0||t%400==0)?((a=new Date(new Date(e,parseInt(a[0])-1,parseInt(a[1])).getTime())).setHours(0,0,0,0),a):null}function o(e,t){if(!t)return e;var n=0,a=0,r=0,i=t.split(" ");if(i.length)for(var f=0;f<i.length;f++){var u=i[f].toLowerCase();-1<u.indexOf("y")&&(n+=parseInt(u.replace("y",""))),-1<u.indexOf("m")&&(a+=parseInt(u.replace("m",""))),-1<u.indexOf("d")&&(r+=parseInt(u.replace("d","")))}return function(e,t,n,a){e=new Date(e.getTime());return e.setFullYear(e.getFullYear()+a),e.setMonth(e.getMonth()+n),e.setDate(e.getDate()+t),e}(e,r,a,n)}function c(e,t,n){var a,r=t.field.data(e),i=null;return r&&(h[e][n]?i=h[e][n]:new RegExp("[0-9]{2}-[0-9]{2}([0-9]{4})?").test(r)?(i=l(r),h[e][n]=i):0===r.indexOf("[field")?(a=/field.(.+?)\]/.exec(r))&&(!(a=t.field.closest(".wapf").find(".input-"+a[1]))||(a=p.getFieldValue(a,!0))&&(i=o(dpParseDate(a,wapf_config.date_format),r.replace(/\[(.+)\]/,"").trim()))):(i=o(t.today,r),h[e][n]=i)),i}var g={},h={min:{},max:{}};WAPF.Filter.add("date/selectable",function(e,t){if(!e)return!e;var n=t.field.data("fieldId");if(t.field.data("disable-after")&&t.isToday){var a=t.field.data("disable-after").split(":"),r=new Date((new Date).getTime()+(1e3*t.offset+6e4*(new Date).getTimezoneOffset()));if(r.getHours()>=parseInt(a[0])&&r.getMinutes()>=parseInt(a[1]))return!1}if(void 0!==t.field.data("disabled-days")&&-1<(f=(""+t.field.data("disabled-days")).split(",").map(function(e){return parseInt(e)})).indexOf(t.date.getDay()))return!1;a=c("min",t,n);if(a&&t.date<a)return!1;if((a=c("max",t,n))&&t.date>a)return!1;if(t.field.data("disabled-dates")){g[n]||(g[n]=[],t.field.data("disabled-dates").split(",").map(function(e){return e.trim()}).forEach(function(e){var t;-1<e.indexOf(" ")?(t=e.split(" "),g[n].push({start:t[0].split(/-/g),end:t[1].split(/-/g)})):g[n].push({start:e.split(/-/g)})}));for(var i=0;i<g[n].length;i++){var f,u=g[n][i];if(f=l(u.start,2===u.start.length?t.date.getFullYear():null,u.end))if(u.end){u=l(u.end,2===u.end.length?t.date.getFullYear():null,!0);if(u&&t.date>=f&&t.date<=u)return!1}else if(t.date.getMonth()===f.getMonth()&&t.date.getFullYear()===f.getFullYear()&&t.date.getDate()===f.getDate())return!1}}return e}),jQuery(document).on("wapf/before_init",function(e,t){var i=t.find(s+"field-calc");i.length&&(jQuery(document).on("wapf/cloned wapf/uncloned",function(){i=t.find(s+"field-calc")}),jQuery(document).on("wapf/cloned",function(e,t,a,n,r){n.find(s+"calc-text").each(function(e,t){var n=jQuery(t);"default"===n.data("type")&&(t=p.cloneFx(n.data("formula"),r,a),n.attr("data-formula",t).data("formula",t))}),n.find(".calc-raw").each(function(e,t){t=jQuery(t);t.attr("name","wapf[field_"+t.data("fieldId")+"_clone_"+a+"_raw]")})}),jQuery(document).on("wapf/pricing",function(e,t,n,a,r){const o=wapf_config.display_options;let c=!1;i.each(function(e,t){const n=jQuery(t),a=n.find(s+"calc-text"),r=n.find(s+"input"),i=n.find(".calc-raw");var f=a.data("type");const u=a.data("txt");t=r.data("price");let d,l=0;"cost"===f?d=l=p.formatMoney(WAPF.Filter.apply("wapf/fx/hint",t||0),o):(d=l=t||"","number"===a.data("format")&&(d=p.evalFx(l),l=d,d=p.formatNumber(d,o.decimals,o.thousand,o.decimal,o.trim_zeroes))),d=u.replace(/\{result}/g,d).trim(),a.html().trim()!==d&&(r.data("raw",l),i.val(l),a.html(d),r.val(d),c=!0)}),c&&WAPF.Util.doDependencies(r)})),t.on("input",".wapf-checkbox.wapf-custom-qty",function(e){var t=jQuery(e.target),n=t.closest(".wapf-custom-qty"),a=n.find('input[type="number"]'),e=parseInt(a.val())||0;"number"===t.attr("type")?n.find('input[type="checkbox"]').prop("checked",0<e).trigger("change"):t.is(":checked")&&!e?a.val(1).trigger("change"):t.is(":checked")||a.val(0).trigger("change")})})}();